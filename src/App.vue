<script setup lang="ts">
import html2canvas from 'html2canvas';
import { ref } from 'vue';
import { saveAs } from "file-saver";
import SideBar from './components/SideBar.vue';
import { titleRef, arRef, enRef, containerRef } from './store/style';
import { Icon } from "@iconify/vue"

const ar = ref('');

const en = ref('');

const title = ref(`Qur'an - `);

const preview = ref('');

const sidebarOpen = ref(false);

function wrapArabicNumbers(event: Event) {
  ar.value = (event.target as HTMLInputElement).value.replace(/[\u0660-\u0669]+/g, (digit) => `<span class='v'>${digit}</span>`);
}

function createURL(event: Event) {
  let input = event.target as HTMLInputElement;
  if (!input.files || input.files.length == 0) return '';

  preview.value = URL.createObjectURL(input.files[0]);
}

function getImage() {
  html2canvas(document.getElementById('container') as HTMLElement, {
    scale: 1.8,
  }).then(canvas => {
    canvas.toBlob(function (blob) {
      saveAs(blob as Blob | string, `${title.value}.png`);
    }, "image/png");
  });
}
</script>

<template>
  <SideBar v-model="sidebarOpen" />
  <main>
    <nav>
      <Icon @click="sidebarOpen = true" icon="uil:bars" class=" hide-lg"/>
      <div class="title">Create Post</div>
    </nav>
    <section class="editor">
      <div class="post-container">
        <div class="container" id="container" ref="containerRef">
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="220" height="45" baseProfile="tiny"
              overflow="inherit" viewBox="0 0 176 36">
              <switch>
                <g>
                  <path fill="currentColor"
                    d="M165.716 11.67q-.879-.134-1.306-.134-.416 0-1.099.818-.586.708-.586.928a.2.2 0 0 0 .03.061q.018.024.055.024.013 0 .244-.189c.231-.189.301-.189.439-.189q1.453 0 2.014.281-.536.39-1.757.781-.989.317-.965.427.036.122 1.025.037.977-.086 1.343-.256.464-.22 1.074-.952.659-.782.659-1.233.002-.222-1.17-.404m1.953 6.835q-.037 0-.201.391-.165.39-.507.391-.501 0-.501-.611 0-.268.153-.75.152-.482.152-.641 0-.097-.062-.122-.207-.11-.549.793-.33.855-.329 1.257 0 .416.243.807.281.426.672.427.513 0 .817-.537.257-.452.257-1.013.002-.416-.145-.392m4.571 9.026q-.799-.407-.971-.408-.085 0-.451.775-.366.774-.366.958 0 .085.787.537.787.451.946.451.134 0 .494-.806.359-.806.359-1.025 0-.071-.798-.482m2.203 3.449q-.086-.037-2.588 1.11-2.55 1.171-2.844 1.429-.244.206-.599.671-.426.549-.427.745 0 .023.024.036-.11 0 2.515-1.233 1.379-.647 2.685-1.244.245-.159.732-.696.526-.586.525-.781.002-.025-.023-.037m-1.025-13.061q-1.61-3.051-1.978-3.051-.354 0-.354 1.514 0 .525.122 1.306.133.818.231.818.184 0 .184-1.208.598.793 1.672 2.881 1.184 2.294 1.184 2.917 0 .428-.635.428-.451 0-1.099-.184-.732-.195-.988-.451.11-.733-.098-.781-.171-.036-.537.866-.366.904-.598.903-.879 0-1.453-.427.231-.781.269-.928 0-.147-.085-.208-.16-.049-.452.44-.391.658-.757.939-.5.39-1.44.391-1.086 0-1.171-.172.182-.108.348-.488.164-.378.164-.622 0-.146-.085-.158-.11-.025-.342.256a2.5 2.5 0 0 1-.684.586q-1.367.78-10.388 1.771-4.37.475-11.107.842-7.238.39-12.779.391-11.524 0-21.837-1.025-4.456-.44-5.884-.732-3.674-.745-5.078-2.307-.647-.72-.951-.708-.635.025-1.294 1.196-.61 1.061-.61 1.77 0 .488.562 1.001-3.332 2.404-5.163 3.638-.5.329-.452.415.012.036.086.036.55 0 2.416-.756 1.868-.758 2.295-1.148.732-.67 1.245-1.904.403.269 1.41.55 1.007.28 1.482.257.148-.013.391-.745 3.467.831 9.924 1.452 4.382.427 11.303.721 6.238.269 10.083.269 4.516 0 12.328-.488 7.47-.465 12.06-.989 7.25-.829 9.496-1.916a1.7 1.7 0 0 0-.085.439q0 .489 1.854.488 1.281 0 2.161-1.025.879.709 1.94.708.598 0 1.196-1.807.318.282 1.11.732.941.537 1.294.537t.77-.537q.536-.708.537-1.831 0-1.578-1.733-4.862M96.61 4.59q-.164-.183-.359-.183-1.27 0-2.161 1.904-.208-.012-.524-.165t-.464-.152q-.476 0-.988.659-.465.598-.465.964 0 .123.098.122.05 0 .385-.397.336-.396.58-.396.195 0 .629.213.433.214.823.214 1.026 0 1.819-.696.793-.695.793-1.709a.57.57 0 0 0-.166-.378m-1.788 10.669a1764 1764 0 0 0-.977-4.492q-.377-1.88-.464-1.879-.353 0-.354 2.551l.744 3.271q.793 3.417.989 4.601l.293 2.063q.158 1.05.231 1.05.354 0 .354-2.295.003-1.062-.816-4.87M85.998 6.91a7.4 7.4 0 0 0-.391 1.135q1.318 1.452 1.453 3.332.037.549.109.549.27 0 .269-1.306 0-2.075-1.44-3.71m2.514 6.298q-.123-.756-.317-.745-.158 0-.122.415.048.489-.024.61a.63.63 0 0 1-.366.159q-.243.025-.342-.122-.049-.085-.073-.513-.012-.342-.134-.342-.123.025-.171.427-.061.525-.11.635-.158.354-.646.427-.366 0-.452-.427 0-.134.085-.397t.085-.384q0-.098-.073-.134-.012-.012-.037-.012-.147 0-.415.72-.195.513-.146.879.11.867.952.781.44-.037.891-.61.183.171.513.171.94 0 .94-1.123a3 3 0 0 0-.038-.415m-10.4-8.911q-1.281 0-2.185 1.904-.171-.025-.494-.189-.323-.165-.495-.165-.451 0-.977.684-.476.623-.476.977 0 .134.098.134.062 0 .402-.403.342-.403.598-.403.184 0 .623.195c.439.195.559.196.794.196q1.026 0 1.794-.659.818-.708.818-1.709.001-.562-.5-.562m13.793 16.82-1.953-5.053q-.085-.208-.171-.208-.025.012-.073.317-.147.903-.146 1.123 0 .587 1.007 3.033 1.008 2.447 1.008 2.802 0 .244-.415.244a2 2 0 0 1-.317.024 1.86 1.86 0 0 1-1.526-.732q-.428-.538-.952-2.697a486 486 0 0 1-.671-2.918q-.184-.781-.317-.781-.428.806-.428 1.526 0 .171.184.879.635 2.467.635 3.186 0 .904-.721 1.415-.635.452-1.574.452-1.465 0-1.66-1.416-.073-.524-.073-2.331 0-.989-.073-.989-.208 0-.391.818a2.8 2.8 0 0 0-.073.599q0 .073-1.062.573-1.281.611-1.977 1.33-.415.428-.769 1.318-.232.561.293.843.39.208 1.013.207 1.355 0 1.794-.598.036-.037.293-.501.171-.318.354-.415.049 1.16.452 1.697.659.879 1.807.879 1.209 0 1.978-.989.414-.525.622-1.257.147-.49.22-.574.036.026.159.513.158.622.415 1.038.219.354.769.629.55.274.989.273.94 0 1.354-1.037.208-.513.208-1.599-.006-1.072-.212-1.623m-10.247-7.665q-.812-.744-1.739-.745-.391 0-.391.5 0 .452.281.635-.135.354-.134.952 0 .707.806.842-.428.61-1.404 1.306a86 86 0 0 1-1.367.928q-.745.5-.684.635.024.061.134.061.33 0 1.221-.488.843-.464 1.331-.842.769-.597 1.416-1.562.159 0 .495.14t.458.14q.391 0 .391-.842-.003-.915-.814-1.66m15.679 16.075q-.305 0-2.087.854-1.733.83-2.112 1.123-.597.598-.744.781-.391.487-.317.599.012.012.049.012a70 70 0 0 0 1.465-.793 96 96 0 0 1 2.941-1.404q.158-.122.488-.567.33-.446.33-.592 0-.013-.013-.013M75.781 12.952q-.623-3.418-.671-3.808-.11-.854-.244-.854-.061 0-.299 1.428-.239 1.428-.189 1.685.965 5.517 1.367 7.775.269 1.574.5 4.589.024.319.171.318.183 0 .183-.208.232-1.22.146-3.54-.085-2.552-.964-7.385m-5.859-7.556q-.073-.024-3.112 1.367-3.088 1.416-3.455 1.697-.22.17-.586.659-.403.525-.403.72 0 .037.024.037-.171 0 2.478-1.233 2.258-1.05 3.808-1.733.244-.147.751-.714.506-.567.506-.775.001-.012-.011-.025m-1.38 5.761q-.159-.854-.39-.818-.123.024-.123.208 0 .123.037.36.037.239.037.36 0 .61-.513.61a.33.33 0 0 1-.317-.195q-.037-.073-.11-.598-.061-.414-.183-.391-.135.025-.183.464a9 9 0 0 1-.098.708q-.123.391-.671.452-.391.098-.488-.427a1.1 1.1 0 0 1 .037-.403 2 2 0 0 0 .073-.415q0-.133-.073-.171-.025 0-.037-.012-.135 0-.427.793-.135.586-.073.952a.94.94 0 0 0 .366.623.84.84 0 0 0 .696.159q.67-.123.916-.671a.79.79 0 0 0 .634.293q.952 0 .952-1.282 0-.269-.062-.599m11.536 16.4q-1.77.86-2.1 1.153-.672.598-.781.744-.39.5-.281.61a.05.05 0 0 0 .037.013q.074 0 .525-.269.634-.379.928-.525a217 217 0 0 1 2.966-1.416q.39-.293.72-.695.403-.476.085-.477-.33 0-2.099.862M59.547 7.3q-.879-.134-1.318-.134-.415 0-1.099.83-.598.72-.598.916a.2.2 0 0 0 .037.048.08.08 0 0 0 .061.024q.024 0 .25-.189t.421-.189q.293 0 1.05.11.818.121.964.208-.537.366-1.746.757-.989.317-.977.415.037.085.427.085 1.245 0 1.941-.305.452-.196 1.086-.94.684-.782.684-1.208.001-.245-1.183-.428M72.4 16.271q-.854-4.833-.854-4.907.39-1.171.391-1.27-.012-.049-.22-.195-.574-.403-.647-1.294-.036-.391-.122-.391-.17 0-.415.879-.22.793-.22 1.135 0 .513.281.891l1.001 5.419q.977 5.273.977 6.03 0 .83-1.392.83-.317 0-.452-.062a7 7 0 0 1-.769-.769q-.317.915-.574 1.867.745.501.745 1.172 0 .427-.928 1.343-1.929 1.905-4.406 1.904-.39 0-1.16-.11a9 9 0 0 0-1.147-.109q-.183 0-.183.098 0 .219.83.646a8 8 0 0 0 1.233.537q1.428.489 2.014.488 1.025 0 2.502-1.391 1.684-1.588 2.026-3.553 1.172 0 1.782-1.074.513-.879.513-2.136 0-1.423-.806-5.978m-19.261-8.47q-.232.525-.391 1.123.818.891 1.159 1.904.195.598.269 1.428.048.562.122.562.282 0 .281-1.306 0-2.076-1.44-3.711M50.38 4.334q-1.233 0-2.16 1.904-.22-.012-.531-.183t-.458-.171q-.476 0-.989.671-.465.599-.464.989 0 .134.11.134.061 0 .391-.403c.33-.403.407-.403.562-.403q.207 0 .641.195t.812.195q1.038 0 1.825-.678.787-.677.787-1.69-.002-.56-.526-.56m2.325 10.791q-.787-.44-.946-.439-.123 0-.378.72-.256.72-.256.939 0 .183.69.623.689.439.897.439.122 0 .452-.793c.33-.793.33-.854.33-.976q-.001-.075-.789-.513m-4.095-2.1q-.574-2.77-.745-3.821-.134-.805-.281-.805-.061 0-.268 1.434t-.159 1.678a860 860 0 0 0 1.379 7.031q.317 1.71.574 4.59.073.318.208.317.097 0 .171-.244.196-1.27.073-3.504-.147-2.746-.952-6.676m-8.129-1.55q-.159-.854-.391-.818-.123.024-.122.208 0 .123.042.36c.042.237.043.279.043.36q0 .61-.525.61-.208 0-.317-.195a13 13 0 0 1-.085-.476l-.012-.122q-.061-.402-.183-.391-.147.025-.195.464-.061.647-.085.708-.123.391-.671.452-.391.098-.5-.415-.025-.122.043-.433.067-.312.067-.409 0-.134-.073-.183-.135-.073-.464.806-.135.525-.061.952.122.793.842.793.793 0 1.135-.684a.75.75 0 0 0 .623.293q.952 0 .952-1.282a3.6 3.6 0 0 0-.063-.598m15.422 17.552q-1.764.842-2.093 1.135a7.5 7.5 0 0 0-.745.781q-.416.5-.317.598.012 0 1.514-.781a94 94 0 0 1 2.941-1.402q.428-.344.72-.696.39-.476.085-.476-.34 0-2.105.841M44.667 13.708q-.99-5.42-1.257-5.31-.33.134-.525 1.806a18 18 0 0 0-.146 2.039q0 2.039.195 3.65.171 1.44.342 1.44.085 0 .085-.72l-.073-2.587q-.036-1.794.061-2.698l.891 4.651q.77 4.028.769 4.785 0 .379-.781.525-.708.134-.989.012-.464-.343-.671-.574-.403-.268-.635.635-.244.892.11 1.246.806.634.806 1.195 0 .929-1.489 2.148-1.563 1.281-2.929 1.281-1.367 0-1.904-.879-.269-.439-.354-1.391-.074-.806-.171-.807-.256 0-.256 1.002 0 .953.354 1.758.89 2.013 2.93 2.014 1.685 0 3.161-2.039 1.391-1.916 1.331-3.552 1.245-.11 1.746-1.001.378-.683.378-2.062-.003-1.245-.979-6.567m-14.452-6.2q-9.411 2.355-11.852 3.54-1.185.575-1.929 1.44-.598.696-.598 1.05 0 .073.061.073-.024-.012.562-.403.818-.549 2.258-1.099 3.894-1.49 10.18-3.002 6.42-1.55 13.5-3.113.794-.818 1.367-1.489-4.82.817-13.549 3.003m35.325 8.593q-.61-.244-2.527-1.245-1.012-.525-1.855-.525-1.588 0-2.197 1.501-.074.257-.134.512a23 23 0 0 1 1.575-.061q.879 0 1.428.098.66.183 1.794.634-3.942.525-5.188 1.697-.306.282-.879 1.196-.55.854-.781 1.038-.537.427-1.636.427-.5 0-.689-.141-.19-.14-.476-.641c-.286-.501-.352-.558-.482-.671q-.098-.086-.446.769c-.348.855-.262.973-.091 1.208q.745.99.745 1.904 0 2.783-8.02 5.835-6.567 2.502-14.806 2.502-8.215 0-14.489-3.319a18.3 18.3 0 0 1-3.039-2.027 24 24 0 0 1-1.831-1.696q-.672-.684-.757-.622-.012.012-.012.061 0 .513 1.355 2.539 1.501 2.246 2.722 3.125 2.295 1.647 6.188 2.734 4.493 1.257 9.582 1.257 8.544 0 16.503-3.356 6.908-2.906 7.445-7.629.183.012.342.012 1.575 0 2.38-1.672 1.184 1.44 2.979 1.44.5 0 .891-.903.342-.782.341-1.355 0-.902-.891-1.66.586-.256 2.05-.549 1.635-.33 2.759-.33 1.806 0 4.028.745 1.233-1.453 1.172-1.453-3.38-.708-5.053-1.379m-49.618-9.02q-.867-.134-1.306-.134-.428 0-1.11.83-.574.708-.574.916 0 .085.073.085.025 0 .25-.189c.225-.189.287-.189.409-.189q.318 0 1.062.098.806.122.989.22-.537.366-1.757.756-1.001.318-.964.403.01.096.438.096 1.233 0 1.929-.268.452-.232 1.074-.977.659-.793.659-1.221 0-.243-1.172-.426m6.042 8.495a11 11 0 0 0-.11.549q-.11.501-.525.501-.768 0-.769-1.196 0-.11.012-.33.012-.219.012-.33 0-.244-.073-.256-.16-.024-.293.732a6 6 0 0 0-.122 1.025q0 .575.269 1.062.317.574.854.574.488 0 .769-.525.22-.427.22-.964 0-.94-.244-.842m7.25 7.738q-.024-.024-.201.458t-.177.592q0 .036.024.073 1.257 1.38 1.428 3.332.048.562.122.562.244 0 .244-1.282.002-2.099-1.44-3.735m8.899-6.078q-1.196-.305-2.917-.964-1.281-.488-1.538-.488-1.05 0-1.672.939-.452.683-.452 1.196 0 .037.012.049.537-.049 1.074-.049 2.16 0 4.052.757-2.405 1.282-3.686 1.282-.72 0-1.147-.354-.293-.243-.293-.427 0 .086.061-.33.037-.231-.098-.269-.086-.024-.391.317-.415.476-1.099.769-1.452.622-4.406 1.11-3.357.55-6.762.55-6.201 0-8.471-2.502-.659-.72-.928-.708-.672.025-1.318 1.184-.585 1.05-.585 1.782 0 .488.561.989-3.21 2.318-5.151 3.612-.513.341-.464.452.012.035.098.036.537 0 2.423-.763t2.289-1.142q.72-.659 1.233-1.916.415.257 1.428.549c1.013.292 1.164.285 1.465.269q.305-.097.464-.817 1.697.854 5.969.854 4.43 0 8.239-.781 4.248-.866 4.846-2.258.745 1.452 1.624 1.452.622 0 3.601-1.221c2.979-1.221 3.41-1.221 4.272-1.221q1 0 1.879.244.097.024.574-.842.39-.72.391-.83 0-.024-.012-.024-3.274.003-5.165-.486m-15.118 7.116q-.848-.403-.958-.365-.39.683-.635 1.306l-1.05-.464q-.647-.282-.756-.244-.123.036-.397.83c-.274.794-.262.842-.238.939q.024.098.83.471.806.372.977.372.147 0 .635-1.306 1.465.817 1.733.744.11-.036.452-.836c.342-.8.325-.844.293-.934q-.037-.11-.886-.513m-14.72 4.822q-1.764.842-2.118 1.147-1.343 1.147-1.05 1.33.012.013.049.013.183-.134 1.477-.794a180 180 0 0 1 2.93-1.416q.366-.22.732-.646.403-.476.085-.476-.341 0-2.105.842M95.494 6.238q-.562.183-.977.146.647-1.172 1.232-1.172.428 0 .428.427 0 .368-.683.599m.61 17.284q0-.16.244-.434.243-.274.391-.274.121-.011.451.586.414.756.721 1.037-1.807-.377-1.807-.915M77.331 6.128q-.562.183-.977.146.623-1.196 1.233-1.196.427 0 .427.452.001.366-.683.598m4.663 8.935q-.195 0-.66-.159.062-.257.062-.452a.74.74 0 0 0-.062-.33q.171.024.513.391.28.306.28.439a.1.1 0 0 1-.012.049q-.012.062-.121.062m-1.196-.231q-.672 0-.671-.256 0-.562.391-.562.354 0 .354.427a1.3 1.3 0 0 1-.074.391m2.306 7.628a3.53 3.53 0 0 1-1.916.366q-.562-.048-.562-.158 0-.231 2.514-1.514-.035.317-.036 1.306M49.623 6.153q-.573.195-.977.159.647-1.172 1.233-1.172.427 0 .427.427.001.354-.683.586m10.705 15.05q-.537 0-1.257-.402a2 2 0 0 1-.5-.391q-.293-.306-.171-.488.086-.11.452-.086.403.037.684.184.964.512.964 1.074-.001.108-.172.109M8.745 19.922q0-.158.244-.439c.244-.281.297-.289.403-.306q.11 0 .439.61.403.757.72 1.05-1.806-.379-1.806-.915">
                  </path>
                </g>
              </switch>
            </svg>
          </div>

          <img v-if="preview" :src="preview" alt="">
          <p class="ar" id="ar" v-html="ar" ref="arRef"></p>
          <p id="en" ref="enRef">{{ en }}</p>
          <div class="heading" ref="titleRef">{{ title }}</div>

          <div class="watermark">Hidayah HQ</div>
        </div>
      </div>
      <div class="form-container">
        <form @submit.prevent="getImage">
          <div class="group">
            <label for="title">Title</label>
            <input type="text" id="title" name="title" v-model.trim="title" required />
          </div>
          <div class="group">
            <label for="ar">Arabic text</label>
            <textarea id="ar" type="text" rows="10" name="ar" @input="wrapArabicNumbers"></textarea>
          </div>

          <div class="group">
            <label for="en">English text</label>
            <textarea id="en" type="text" rows="10" v-model.trim="en" required></textarea>
          </div>

          <div class="group">
            <label>Select image</label>
            <input type="file" accept="image/*" @change="createURL" />
          </div>

          <button>Generate</button>
        </form>
      </div>
    </section>
  </main>
</template>
